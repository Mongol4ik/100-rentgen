<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>–ù–æ–≤–æ—Å—Ç–∏ - 100 –†–µ–Ω—Ç–≥–µ–Ω</title>
<style>
  :root{
    --accent:#ff9800;
    --bg:#850000;
    --panel-bg:rgba(18,18,18,0.96);
    --muted:#9aa;
    --card:#101010;
    --glass: rgba(255,255,255,0.03);
  }
  *{box-sizing:border-box}
  html,body{height:100%;margin:0;font-family:Inter,system-ui,Arial,sans-serif;background:url('https://i.imgur.com/Z1OWJQa.png') center/cover fixed;color:#fff}
  a{color:inherit}
  button,input,select,textarea{font:inherit}
  button{cursor:pointer}

  header{display:flex;justify-content:space-between;align-items:center;padding:12px 18px;background:linear-gradient(180deg,rgba(0,0,0,0.6),rgba(0,0,0,0.2));gap:12px;position:sticky;top:0;z-index:40}
  .brand{display:flex;flex-direction:column}
  .brand h1{margin:0;font-size:18px}
  .controls{display:flex;gap:8px}

  .container{padding:18px;max-width:1000px;margin:0 auto}
  
  .panel{background:var(--panel-bg);padding:16px;border-radius:10px;border:1px solid var(--glass);margin-bottom:18px}
  
  .btn{background:var(--accent);color:#000;padding:8px 16px;border-radius:8px;border:none;text-decoration:none;display:inline-block}
  .ghost{background:transparent;border:1px solid var(--glass);color:#fff;padding:6px 12px;border-radius:6px}
  
  .news-card{background:var(--card);border:1px solid var(--glass);padding:16px;border-radius:8px;margin-bottom:16px}
  .news-header{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:12px}
  .news-title{font-size:18px;font-weight:bold;margin:0;flex:1}
  .news-date{color:var(--muted);font-size:14px;margin-left:12px}
  .news-content{line-height:1.5;margin-bottom:12px}
  .news-image{max-width:100%;border-radius:6px;margin:12px 0}
  .news-author{color:var(--muted);font-size:14px;border-top:1px solid var(--glass);padding-top:8px}
  
  .form-row{display:flex;gap:12px;margin-bottom:12px;align-items:center}
  input,select,textarea{width:100%;padding:8px;border-radius:6px;border:1px solid #222;background:#080808;color:#fff}
  textarea{min-height:100px;resize:vertical}
  
  .small-muted{font-size:12px;color:var(--muted)}
  .muted{color:var(--muted)}
</style>
</head>
<body>

<header>
  <div class="brand">
    <h1>üì∞ –ù–æ–≤–æ—Å—Ç–∏ - 100 –†–µ–Ω—Ç–≥–µ–Ω</h1>
    <div class="muted">–õ–µ–Ω—Ç–∞ –Ω–æ–≤–æ—Å—Ç–µ–π</div>
  </div>
  <div class="controls">
    <button id="btnAdmin" class="ghost">–ü–∞–Ω–µ–ª—å –∞–¥–º–∏–Ω–∞</button>
    <a href="index.html" class="btn">‚Üê –í –º–∞–≥–∞–∑–∏–Ω</a>
  </div>
</header>

<div class="container">
  <!-- –õ–µ–Ω—Ç–∞ –Ω–æ–≤–æ—Å—Ç–µ–π -->
  <div id="newsFeed">
    <div class="panel">
      <h3>üì¢ –ü–æ—Å–ª–µ–¥–Ω–∏–µ –Ω–æ–≤–æ—Å—Ç–∏</h3>
      <div id="newsList"></div>
    </div>
  </div>

  <!-- –ü–∞–Ω–µ–ª—å –∞–¥–º–∏–Ω–∞ -->
  <div id="adminPanel" class="panel" style="display:none">
    <h3>üëë –ü–∞–Ω–µ–ª—å –∞–¥–º–∏–Ω–∞ –Ω–æ–≤–æ—Å—Ç–µ–π</h3>
    
    <div id="newsAdminLoginArea">
      <input id="newsAdminPass" placeholder="–ü–∞—Ä–æ–ª—å –∞–¥–º–∏–Ω–∞ –Ω–æ–≤–æ—Å—Ç–µ–π" type="password" />
      <div style="display:flex;gap:8px;margin-top:8px">
        <button id="btnNewsAdminLogin" class="btn">–í–æ–π—Ç–∏</button>
        <button class="ghost" onclick="closeAdminPanel()">–ó–∞–∫—Ä—ã—Ç—å</button>
      </div>
    </div>

    <div id="newsAdminArea" style="display:none;margin-top:12px">
      <div class="tabs" style="display:flex;gap:8px;margin-bottom:16px">
        <button class="tab active" data-admin-tab="createNews">–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤–æ—Å—Ç—å</button>
        <button class="tab" data-admin-tab="manageNews">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ—Å—Ç—è–º–∏</button>
        <button class="ghost" onclick="closeAdminPanel()" style="margin-left:auto">–í—ã–π—Ç–∏</button>
      </div>

      <!-- –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ—Å—Ç–∏ -->
      <div id="createNewsTab" class="admin-tab-content">
        <h4>–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é –∑–∞–ø–∏—Å—å</h4>
        <div class="form-row">
          <input type="text" id="newsTitle" placeholder="–ó–∞–≥–æ–ª–æ–≤–æ–∫ –Ω–æ–≤–æ—Å—Ç–∏" style="flex:2">
        </div>
        <div class="form-row">
          <textarea id="newsContent" placeholder="–¢–µ–∫—Å—Ç –Ω–æ–≤–æ—Å—Ç–∏..."></textarea>
        </div>
        <div class="form-row">
          <input type="text" id="newsImage" placeholder="URL –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)" style="flex:1">
          <input type="text" id="newsAuthor" placeholder="–ê–≤—Ç–æ—Ä" style="flex:1" value="–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ü–∏—è">
        </div>
        <button id="btnCreateNews" class="btn">–û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å –Ω–æ–≤–æ—Å—Ç—å</button>
      </div>

      <!-- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ—Å—Ç—è–º–∏ -->
      <div id="manageNewsTab" class="admin-tab-content" style="display:none">
        <h4>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ—Å—Ç—è–º–∏</h4>
        <div id="newsManagementList"></div>
      </div>
    </div>
  </div>
</div>

<script>
// –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è JSONBin
const JSONBIN_BASE_URL = 'https://api.jsonbin.io/v3/b';
const JSONBIN_MASTER_KEY = 'MASTER_KEY_PLACEHOLDER';
const JSONBIN_ACCESS_KEY = 'ACCESS_KEY_PLACEHOLDER';

const JSONBIN_IDS = {
  NEWS: '691067ab43b1c97be9a250bb', 
  CONFIG: '69050c5343b1c97be98f23c9'
};

// –ö–ª—é—á–∏ localStorage
const KEY_NEWS = 'news_v1';
const KEY_SELLER_CONFIG = 'sellerConfig';

// –î–∞–Ω–Ω—ã–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
const DEFAULT_NEWS = [
  {
    id: 1,
    title: "–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –º–∞–≥–∞–∑–∏–Ω 100 –†–µ–Ω—Ç–≥–µ–Ω!",
    content: "–ú—ã —Ä–∞–¥—ã –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–æ–≤–∞—Ç—å –≤–∞—Å –≤ –Ω–∞—à–µ–º –º–∞–≥–∞–∑–∏–Ω–µ. –ó–¥–µ—Å—å –≤—ã –Ω–∞–π–¥–µ—Ç–µ –ª—É—á—à–∏–µ —Ç–æ–≤–∞—Ä—ã –¥–ª—è —Å—Ç–∞–ª–∫–µ—Ä–æ–≤ –ø–æ –¥–æ—Å—Ç—É–ø–Ω—ã–º —Ü–µ–Ω–∞–º. –°–ª–µ–¥–∏—Ç–µ –∑–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è–º–∏ –∏ –∞–∫—Ü–∏—è–º–∏!",
    image: "",
    author: "–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ü–∏—è",
    date: "2024-01-15 10:00",
    status: "published"
  },
  {
    id: 2,
    title: "–ó–∞–ø—É—Å–∫ —Å–∏—Å—Ç–µ–º—ã —Å—Ç–∞–≤–æ–∫ –Ω–∞ –±–æ–∏",
    content: "–¢–µ–ø–µ—Ä—å –≤—ã –º–æ–∂–µ—Ç–µ –¥–µ–ª–∞—Ç—å —Å—Ç–∞–≤–∫–∏ –Ω–∞ –∏—Å—Ö–æ–¥—ã –±–æ–µ–≤ –º–µ–∂–¥—É —Å—Ç–∞–ª–∫–µ—Ä–∞–º–∏ –∏ –º—É—Ç–∞–Ω—Ç–∞–º–∏! –ü–µ—Ä–µ—Ö–æ–¥–∏—Ç–µ –≤ —Ä–∞–∑–¥–µ–ª '–°—Ç–∞–≤–∫–∏ –Ω–∞ –±–æ–∏' –∏ –∏—Å–ø—ã—Ç–∞–π—Ç–µ —É–¥–∞—á—É.",
    image: "",
    author: "–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ü–∏—è", 
    date: "2024-01-16 14:30",
    status: "published"
  }
];

const DEFAULT_CONFIG = {
  sellerPassword: "admin123",
  betsAdminPassword: "bets123",
  newsAdminPassword: "news123"
};

let news = [];
let config = {};

// –£—Ç–∏–ª–∏—Ç—ã
const el = id => document.getElementById(id);

// JSONBin —Ñ—É–Ω–∫—Ü–∏–∏
async function jsonbinFetch(binId) {
  const url = `${JSONBIN_BASE_URL}/${binId}/latest`;
  const headers = {
    'Content-Type': 'application/json',
    'X-Master-Key': JSONBIN_MASTER_KEY,
    'X-Access-Key': JSONBIN_ACCESS_KEY
  };
  
  try {
    const response = await fetch(url, { headers });
    if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
    const data = await response.json();
    return data.record;
  } catch (error) {
    console.error('JSONBin fetch error:', error);
    const fallback = localStorage.getItem(`fallback_${binId}`);
    return fallback ? JSON.parse(fallback) : null;
  }
}

async function jsonbinUpdate(binId, data) {
  const url = `${JSONBIN_BASE_URL}/${binId}`;
  const headers = {
    'Content-Type': 'application/json',
    'X-Master-Key': JSONBIN_MASTER_KEY,
    'X-Access-Key': JSONBIN_ACCESS_KEY
  };
  
  try {
    const response = await fetch(url, {
      method: 'PUT',
      headers: headers,
      body: JSON.stringify(data)
    });
    
    if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
    const result = await response.json();
    localStorage.setItem(`fallback_${binId}`, JSON.stringify(data));
    return result.record;
  } catch (error) {
    console.error('JSONBin update error:', error);
    localStorage.setItem(`fallback_${binId}`, JSON.stringify(data));
    return data;
  }
}

async function loadJSON(key, fallback) {
  try {
    let binId;
    switch(key) {
      case KEY_NEWS: binId = JSONBIN_IDS.NEWS; break;
      case KEY_SELLER_CONFIG: binId = JSONBIN_IDS.CONFIG; break;
      default: return JSON.parse(JSON.stringify(fallback));
    }
    
    const data = await jsonbinFetch(binId);
    return data || JSON.parse(JSON.stringify(fallback));
  } catch(e) {
    console.error('Load error:', e);
    return JSON.parse(JSON.stringify(fallback));
  }
}

async function saveJSON(key, val) {
  try {
    let binId;
    switch(key) {
      case KEY_NEWS: binId = JSONBIN_IDS.NEWS; break;
      case KEY_SELLER_CONFIG: binId = JSONBIN_IDS.CONFIG; break;
      default: return;
    }
    
    await jsonbinUpdate(binId, val);
    return true;
  } catch(e) {
    console.error('Save error:', e);
    return false;
  }
}

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö
async function initializeData() {
  console.log('Starting news initialization...');
  
  try {
    const [newsData, configData] = await Promise.all([
      loadJSON(KEY_NEWS, DEFAULT_NEWS),
      loadJSON(KEY_SELLER_CONFIG, DEFAULT_CONFIG)
    ]);

    news = newsData || DEFAULT_NEWS;
    config = configData || DEFAULT_CONFIG;

    // –ï—Å–ª–∏ bins –ø—É—Å—Ç—ã–µ, —Å–æ–∑–¥–∞–µ–º –Ω–∞—á–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
    if (!newsData || newsData.length === 0) {
      console.log('Creating initial news...');
      news = DEFAULT_NEWS;
      await saveJSON(KEY_NEWS, news);
    }

    if (!configData) {
      console.log('Creating initial config...');
      await saveJSON(KEY_SELLER_CONFIG, DEFAULT_CONFIG);
    }

    console.log('News loaded:', news);
    renderNews();

  } catch (error) {
    console.error('Error initializing news:', error);
    news = DEFAULT_NEWS;
    renderNews();
  }
}

// –†–µ–Ω–¥–µ—Ä –Ω–æ–≤–æ—Å—Ç–µ–π
function renderNews() {
  const list = el('newsList');
  const publishedNews = news.filter(item => item.status === 'published').sort((a, b) => new Date(b.date) - new Date(a.date));
  
  if (publishedNews.length === 0) {
    list.innerHTML = '<div class="muted">–ù–æ–≤–æ—Å—Ç–µ–π –ø–æ–∫–∞ –Ω–µ—Ç</div>';
    return;
  }
  
  list.innerHTML = publishedNews.map(item => `
    <div class="news-card">
      <div class="news-header">
        <h3 class="news-title">${escapeHtml(item.title)}</h3>
        <div class="news-date">${new Date(item.date).toLocaleString()}</div>
      </div>
      ${item.image ? `<img src="${item.image}" alt="${escapeHtml(item.title)}" class="news-image">` : ''}
      <div class="news-content">${escapeHtml(item.content).replace(/\n/g, '<br>')}</div>
      <div class="news-author">–ê–≤—Ç–æ—Ä: ${escapeHtml(item.author)}</div>
    </div>
  `).join('');
}

// –†–µ–Ω–¥–µ—Ä —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –Ω–æ–≤–æ—Å—Ç—è–º–∏
function renderNewsManagement() {
  const list = el('newsManagementList');
  
  if (news.length === 0) {
    list.innerHTML = '<div class="muted">–ù–æ–≤–æ—Å—Ç–µ–π –Ω–µ—Ç</div>';
    return;
  }
  
  // –°–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ –¥–∞—Ç–µ (–Ω–æ–≤—ã–µ —Å–≤–µ—Ä—Ö—É)
  const sortedNews = [...news].sort((a, b) => new Date(b.date) - new Date(a.date));
  
  list.innerHTML = sortedNews.map(item => `
    <div class="news-card">
      <div class="news-header">
        <h4 class="news-title">${escapeHtml(item.title)}</h4>
        <div class="news-date">${new Date(item.date).toLocaleString()}</div>
      </div>
      <div class="news-content" style="max-height: 100px; overflow: hidden;">${escapeHtml(item.content)}</div>
      <div style="display:flex;gap:8px;margin-top:12px">
        <button class="btn" onclick="toggleNewsStatus(${item.id})">
          ${item.status === 'published' ? '–°–Ω—è—Ç—å —Å –ø—É–±–ª–∏–∫–∞—Ü–∏–∏' : '–û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å'}
        </button>
        <button class="ghost" onclick="editNews(${item.id})">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
        <button class="ghost" onclick="deleteNews(${item.id})" style="color:#f44336">–£–¥–∞–ª–∏—Ç—å</button>
      </div>
      <div class="small-muted">–°—Ç–∞—Ç—É—Å: ${item.status === 'published' ? 'üü¢ –û–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–æ' : 'üî¥ –ß–µ—Ä–Ω–æ–≤–∏–∫'}</div>
    </div>
  `).join('');
}

// –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ—Å—Ç–∏
async function createNews() {
  const title = el('newsTitle').value.trim();
  const content = el('newsContent').value.trim();
  const image = el('newsImage').value.trim();
  const author = el('newsAuthor').value.trim() || '–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ü–∏—è';
  
  if (!title || !content) {
    alert('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –∑–∞–≥–æ–ª–æ–≤–æ–∫ –∏ —Ç–µ–∫—Å—Ç –Ω–æ–≤–æ—Å—Ç–∏');
    return;
  }
  
  const newItem = {
    id: Date.now(),
    title: title,
    content: content,
    image: image,
    author: author,
    date: new Date().toISOString(),
    status: 'published'
  };
  
  news.push(newItem);
  const saved = await saveJSON(KEY_NEWS, news);
  
  if (saved) {
    alert('–ù–æ–≤–æ—Å—Ç—å –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–∞!');
    // –û—á–∏—â–∞–µ–º –ø–æ–ª—è
    ['newsTitle', 'newsContent', 'newsImage'].forEach(id => {
      el(id).value = '';
    });
    el('newsAuthor').value = '–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ü–∏—è';
    
    renderNews();
    renderNewsManagement();
  } else {
    alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ –Ω–æ–≤–æ—Å—Ç–∏');
  }
}

// –£–¥–∞–ª–µ–Ω–∏–µ –Ω–æ–≤–æ—Å—Ç–∏
async function deleteNews(newsId) {
  if (!confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç—É –Ω–æ–≤–æ—Å—Ç—å?')) {
    return;
  }
  
  news = news.filter(item => item.id !== newsId);
  const saved = await saveJSON(KEY_NEWS, news);
  
  if (saved) {
    alert('–ù–æ–≤–æ—Å—Ç—å —É–¥–∞–ª–µ–Ω–∞!');
    renderNews();
    renderNewsManagement();
  }
}

// –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –Ω–æ–≤–æ—Å—Ç–∏
async function toggleNewsStatus(newsId) {
  const item = news.find(n => n.id === newsId);
  if (item) {
    item.status = item.status === 'published' ? 'draft' : 'published';
    const saved = await saveJSON(KEY_NEWS, news);
    
    if (saved) {
      alert(`–ù–æ–≤–æ—Å—Ç—å ${item.status === 'published' ? '–æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–∞' : '–ø–µ—Ä–µ–º–µ—â–µ–Ω–∞ –≤ —á–µ—Ä–Ω–æ–≤–∏–∫–∏'}!`);
      renderNews();
      renderNewsManagement();
    }
  }
}

// –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–æ–≤–æ—Å—Ç–∏ (—É–ø—Ä–æ—â–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è)
async function editNews(newsId) {
  const item = news.find(n => n.id === newsId);
  if (!item) return;
  
  const newTitle = prompt('–ù–æ–≤—ã–π –∑–∞–≥–æ–ª–æ–≤–æ–∫:', item.title);
  if (newTitle === null) return;
  
  const newContent = prompt('–ù–æ–≤—ã–π —Ç–µ–∫—Å—Ç:', item.content);
  if (newContent === null) return;
  
  item.title = newTitle.trim();
  item.content = newContent.trim();
  item.date = new Date().toISOString();
  
  const saved = await saveJSON(KEY_NEWS, news);
  
  if (saved) {
    alert('–ù–æ–≤–æ—Å—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∞!');
    renderNews();
    renderNewsManagement();
  }
}

// –ê–¥–º–∏–Ω —Ñ—É–Ω–∫—Ü–∏–∏
function closeAdminPanel() {
  el('adminPanel').style.display = 'none';
  el('newsAdminLoginArea').style.display = 'block';
  el('newsAdminArea').style.display = 'none';
  el('newsAdminPass').value = '';
}

el('btnNewsAdminLogin').addEventListener('click', async () => {
  const password = el('newsAdminPass').value;
  
  if (password === config.newsAdminPassword) {
    el('newsAdminLoginArea').style.display = 'none';
    el('newsAdminArea').style.display = 'block';
    renderNewsManagement();
  } else {
    alert('–ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å –∞–¥–º–∏–Ω–∞ –Ω–æ–≤–æ—Å—Ç–µ–π!');
  }
});

el('btnAdmin').addEventListener('click', () => {
  el('adminPanel').style.display = 'block';
  el('newsAdminLoginArea').style.display = 'block';
  el('newsAdminArea').style.display = 'none';
  el('newsAdminPass').value = '';
});

el('btnCreateNews').addEventListener('click', createNews);

// –ê–¥–º–∏–Ω –≤–∫–ª–∞–¥–∫–∏
document.querySelectorAll('[data-admin-tab]').forEach(tab => {
  tab.addEventListener('click', function() {
    document.querySelectorAll('.admin-tab-content').forEach(content => content.style.display = 'none');
    document.querySelectorAll('[data-admin-tab]').forEach(t => t.classList.remove('active'));
    
    el(`${this.dataset.adminTab}Tab`).style.display = 'block';
    this.classList.add('active');
    
    if (this.dataset.adminTab === 'manageNews') {
      renderNewsManagement();
    }
  });
});

// –£—Ç–∏–ª–∏—Ç—ã
function escapeHtml(unsafe) {
  if (!unsafe) return '';
  return unsafe.toString()
    .replace(/&/g, "&amp;")
    .replace(/</g, "&lt;")
    .replace(/>/g, "&gt;")
    .replace(/"/g, "&quot;")
    .replace(/'/g, "&#039;");
}

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
initializeData();
</script>
</body>
</html>
